# ========================================
# OSS管理システム 設定ファイル
# ========================================
#
# このファイルは、プロジェクトのOSS（オープンソースソフトウェア）管理システムを
# 設定します。このファイルをリポジトリのルートに「oss-management-system.yml」
# という名前で配置してください（.example拡張子は削除）。
#
# ファイル配置場所: <リポジトリルート>/oss-management-system.yml
#
# 詳細なドキュメントは以下を参照してください:
# - README.md: 一般的な使用方法とセットアップ
# - CONFIGURATION.md: 包括的な設定ガイド
# - DESIGN.md: 技術アーキテクチャの詳細

# ========================================
# 設定オプション
# ========================================

# pre-project-version
# -------------------
# OSSコンポーネントの変更をチェックする際に比較対象とする
# 過去のプロジェクトバージョンを指定します。システムは、このバージョンの
# SBOM（Software Bill of Materials）をDependency-Trackから取得し、
# 現在のSBOMと比較して以下を識別します:
#   - 追加されたコンポーネント（新しいOSS依存関係）
#   - 削除されたコンポーネント（削除されたOSS依存関係）
#   - 更新されたコンポーネント（バージョン変更）
#
# 型: string（オプション）
# 形式: Gitタグと一致する任意のバージョン文字列
#      （例: "v1.0.0", "1.0.0", "2024.02.10", "release-2024-q1"）
#
# 特殊な動作:
#   - 未設定または空: 最初のバージョンとして扱われる（すべてのコンポーネントが「追加」としてマーク）
#   - DTにバージョンが存在しない: 最初のバージョンとして扱われる（安全なフォールバック）
#
# 更新タイミング:
#   - 各リリース後、この値を新しくリリースされたバージョンに更新
#   - これにより、次の開発サイクルで最新の安定バージョンと比較されます

pre-project-version: v1.0.0


# ========================================
# 使用例
# ========================================

# 例1: 初回リリース（最初のバージョン）
# -------------------------------------------
# プロジェクトを初めてリリースする場合、3つの選択肢があります:
#
# 選択肢A: 設定ファイルを作成しない
#          （システムが自動的に最初のバージョンとして検出します）
#
# 選択肢B: 空の値でファイルを作成:
#   pre-project-version:
#
# 選択肢C: nullでファイルを作成:
#   pre-project-version: null
#
# 結果: すべてのOSSコンポーネントが差分レポートで「追加」としてマークされます。


# 例2: 通常のリリース（'v'プレフィックス付きセマンティックバージョニング）
# -----------------------------------------------------------------
# 'v'プレフィックス付きセマンティックバージョニングを使用するプロジェクトで
# 最も一般的な形式です。各リリース後にこれを更新して、最新バージョンからの
# 変更を追跡します。
#
# pre-project-version: v1.0.0
#
# リリースタイムライン:
#   1. v1.0.0をリリース → 設定を更新: pre-project-version: v1.0.0
#   2. v1.1.0をリリース → 設定を更新: pre-project-version: v1.1.0
#   3. v2.0.0をリリース → 設定を更新: pre-project-version: v2.0.0


# 例3: セマンティックバージョニング（'v'プレフィックスなし）
# ----------------------------------------------------
# バージョンタグに'v'プレフィックスを使用しないプロジェクト向け。
#
# pre-project-version: 1.0.0
#
# 重要: Gitタグの形式と正確に一致させてください！
#   Gitタグ: 1.0.0, 1.1.0, 1.2.0
#   設定:    pre-project-version: 1.1.0  ✓ 正しい
#   設定:    pre-project-version: v1.1.0 ✗ 間違い（不一致）


# 例4: 日付ベースのバージョニング
# ---------------------------------
# 日付ベースのバージョンスキームを使用するプロジェクト向け。
#
# pre-project-version: 2024.02.10
#
# または時刻付き:
# pre-project-version: 2024.02.10.1430


# 例5: カスタムバージョニングスキーム
# ------------------------------------
# カスタムバージョン命名規則を使用するプロジェクト向け。
#
# pre-project-version: release-2024-q1
#
# または:
# pre-project-version: sprint-42
#
# または:
# pre-project-version: milestone-3


# 例6: プレリリースバージョン
# --------------------------------
# ベータ版、RC版、その他のプレリリースバージョンと比較する場合。
#
# pre-project-version: v2.0.0-beta.1
#
# または:
# pre-project-version: v2.0.0-rc.2
#
# 注意: これらのバージョンがDependency-Trackに登録されていることを確認してください！


# 例7: バージョンのスキップ（古いベースラインとの比較）
# ----------------------------------------------------------------
# 直前のバージョンだけでなく、任意の過去のバージョンと比較できます。
# 累積的な変更を分析したり、メジャーリリースのベースラインと比較する際に便利です。
#
# 現在のバージョン: v1.3.0
# 比較対象: v1.0.0（v1.1.0とv1.2.0をスキップ）
#
# pre-project-version: v1.0.0
#
# 使用例:
#   - メジャーリリースのベースラインとの比較
#   - 複数バージョンにわたる累積的な変更の分析
#   - 既知の安定バージョンとの比較


# 例8: ブランチ固有の設定
# ------------------------------------------
# 異なるブランチで異なる比較対象を設定できます。
#
# メインブランチ（main）:
#   pre-project-version: v2.0.0
#
# ステージングブランチ（staging）:
#   pre-project-version: v2.0.0-rc.1
#
# 開発ブランチ（develop）:
#   pre-project-version: v1.9.0
#
# フィーチャーブランチ（feature/new-api）:
#   pre-project-version: v2.0.0  （メインのベースラインと比較）


# 例9: ホットフィックスシナリオ
# ---------------------------
# 古いバージョンからホットフィックスを作成する場合。
#
# シナリオ: メインがv2.0.0の時にv1.0.0のホットフィックスを作成
#
# ホットフィックスブランチ（hotfix/1.0.1）:
#   pre-project-version: v1.0.0
#
# メインブランチ（main）:
#   pre-project-version: v2.0.0


# 例10: モノレポ設定
# -----------------------------------
# モノレポの場合、リポジトリルートに単一の設定ファイルを配置します。
# すべてのサービス/パッケージが同じベースラインバージョンを使用します。
#
# リポジトリ構造:
#   monorepo/
#   ├── oss-management-system.yml  ← リポジトリ全体の単一設定
#   ├── service-a/
#   ├── service-b/
#   └── shared-lib/
#
# 設定:
#   pre-project-version: v1.5.0
#
# 注意: すべてのサービスがv1.5.0と比較されます


# ========================================
# ワークフロー統合
# ========================================

# この設定ファイルは、以下のタイミングでOSS管理システムのワークフローによって
# 自動的に読み取られます:
#
# 1. プルリクエストの作成/更新時:
#    - PRブランチから設定を読み取り
#    - 指定されたバージョンと現在のSBOMを比較
#    - 差分レポートをPRコメントとして投稿
#
# 2. タグ/リリースの作成時:
#    - タグ付けされたコミットから設定を読み取り
#    - 指定されたバージョンと現在のSBOMを比較
#    - 差分を含む見直しIssueを作成
#    - 現在のSBOMをタグバージョンでDependency-Trackにアップロード
#
# 3. 見直しIssueのクローズ時:
#    - 見直し結果を抽出
#    - 必要に応じて承認Issueを作成
#
# 4. 承認Issueのクローズ時:
#    - SBOMをDependency-Trackに登録
#    - 見直し結果に基づいてコンポーネントプロパティを設定


# ========================================
# ベストプラクティス
# ========================================

# 1. 各リリース後に更新
#    リリースチェックリストを作成:
#      □ リリースタグを作成（例: v1.1.0）
#      □ SBOMがDependency-Trackにアップロードされたことを確認
#      □ oss-management-system.ymlをv1.1.0に更新
#      □ 設定の更新をコミット・プッシュ
#      □ 次のPRで正しい比較バージョンが使用されることを確認

# 2. 設定をバージョン管理に含める
#    常にこのファイルをコミット:
#      git add oss-management-system.yml
#      git commit -m "chore: OSSベースラインをv1.1.0に更新"
#      git push

# 3. 一貫したバージョン形式を使用
#    Gitタグの形式と正確に一致させる:
#      Gitタグ: v1.0.0, v1.1.0, v1.2.0
#      設定:    pre-project-version: v1.1.0  ✓ 正しい
#      設定:    pre-project-version: 1.1.0   ✗ 間違い（'v'が欠落）

# 4. バージョン戦略を文書化
#    バージョニングアプローチを説明するコメントを追加:
#      # 最終更新: 2024-02-10
#      # 現在のベースライン: v1.1.0（2024-02-01リリース）
#      # 次回予定リリース: v1.2.0（目標: 2024-03-01）
#      pre-project-version: v1.1.0

# 5. 更新後に設定を検証
#    更新後、テストPRを作成して検証:
#      □ 設定ファイルが正常に読み取られる
#      □ 正しい比較バージョンが使用される
#      □ 期待される差分レポートが生成される


# ========================================
# トラブルシューティング
# ========================================

# 問題: "Config file not found"（設定ファイルが見つかりません）
# 解決策: ファイル名が正確に「oss-management-system.yml」であることを確認
#        リポジトリルートに配置されていることを確認（サブディレクトリではない）

# 問題: "Invalid YAML"（無効なYAML）
# 解決策: YAML構文を検証（インデント、コロン、引用符をチェック）
#        使用: https://www.yamllint.com/

# 問題: "SBOM not found in Dependency-Track"（Dependency-TrackにSBOMが見つかりません）
# 解決策: バージョンがDependency-Trackに存在することを確認
#        バージョン形式が正確に一致することを確認（'v'プレフィックスを含む場合は含める）

# 問題: "Empty pre-project-version value"（pre-project-versionの値が空です）
# 解決策: 有効なバージョン文字列を指定するか、最初のバージョンの場合はファイルを削除

# 問題: "Wrong version being compared"（間違ったバージョンが比較されています）
# 解決策: 設定ファイルがコミット・プッシュされていることを確認
#        正しいブランチの設定を更新していることを確認


# ========================================
# 環境変数からの移行
# ========================================

# 古いPREVIOUS_VERSION環境変数から移行する場合:
#
# 旧方式（GitHub Variables）:
#   PREVIOUS_VERSION=v1.0.0
#
# 新方式（設定ファイル）:
#   pre-project-version: v1.0.0
#
# 移行手順:
#   1. 現在のPREVIOUS_VERSIONの値でoss-management-system.ymlを作成
#   2. 設定ファイルをコミット・プッシュ
#   3. GitHubリポジトリ変数からPREVIOUS_VERSIONを削除（オプション）
#   4. 次のPRで設定ファイルが使用されることを確認
#
# 設定ファイルの利点:
#   ✓ バージョン管理がバージョンコントロールで追跡される
#   ✓ 設定変更がPRレビューで可視化される
#   ✓ 環境変数の設定ミスを防げる
#   ✓ リポジトリごとに独立した設定が可能


# ========================================
# 追加リソース
# ========================================

# ドキュメント:
#   - README.md: 一般的な使用方法とセットアップガイド
#   - CONFIGURATION.md: 包括的な設定リファレンス
#   - DESIGN.md: 技術アーキテクチャと実装の詳細
#   - docs/REUSABLE_WORKFLOWS.md: 他のリポジトリでのワークフロー使用方法

# サポート:
#   - GitHub Issues: バグ報告や機能リクエスト
#   - ワークフローログ: 詳細なバージョン解決情報を確認
#   - Dependency-Track UI: バージョンとSBOMを確認

# ワークフロー例:
#   - docs/usage-examples/caller-pr-sbom-check.yml
#   - docs/usage-examples/caller-tag-sbom-review.yml
#   - docs/usage-examples/caller-review-close.yml
#   - docs/usage-examples/caller-approval-close.yml
